<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rater App with Tags</title>
<style>
  body { font-family: sans-serif; margin: 0; padding: 0; background: #f4f4f4; }
  header { background: #333; color: white; padding: 1rem; text-align: center; }
  nav { display: flex; justify-content: center; margin: 1rem 0; }
  nav button { margin: 0 0.5rem; padding: 0.5rem 1rem; border: none; border-radius: 6px; cursor: pointer; }
  nav button.active { background: #333; color: white; }
  .container { padding: 1rem; }
  .card { background: white; border-radius: 8px; padding: 1rem; margin-bottom: 1rem; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
  input, select, textarea { width: 100%; margin-top: 0.5rem; margin-bottom: 1rem; padding: 0.5rem; border: 1px solid #ccc; border-radius: 6px; }
  button.save { background: #333; color: white; padding: 0.5rem 1rem; border: none; border-radius: 6px; cursor: pointer; }
  .rating { color: gold; }
  .actions { margin-top: 0.5rem; }
  .actions button { margin-right: 0.5rem; padding: 0.3rem 0.7rem; border: none; border-radius: 6px; cursor: pointer; }
  .edit-btn { background: #4caf50; color: white; }
  .delete-btn { background: #e53935; color: white; }
  .tag { display: inline-block; background: #2196f3; color: white; padding: 0.2rem 0.5rem; border-radius: 4px; margin-right: 0.3rem; margin-top: 0.3rem; }
</style>
</head>
<body>
<header><h1>‚≠ê Rater App ‚≠ê</h1></header>
<nav>
  <button id="ratedTab" class="active">Rated</button>
  <button id="wantTab">Want to Try</button>
</nav>

<div class="container">
  <div class="card">
    <h2 id="formTitle">Add Item</h2>
    <input id="itemName" type="text" placeholder="Item name (e.g., Interstellar)">
    <input id="newTagInput" type="text" placeholder="Add new tags, separated by commas">
    <select id="existingTags" multiple size="4"></select>
    <select id="rating">
      <option value="">No Rating (Want to Try)</option>
      <option>1 ‚òÖ</option>
      <option>2 ‚òÖ‚òÖ</option>
      <option>3 ‚òÖ‚òÖ‚òÖ</option>
      <option>4 ‚òÖ‚òÖ‚òÖ‚òÖ</option>
      <option>5 ‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ</option>
    </select>
    <textarea id="comment" placeholder="Add a comment..."></textarea>
    <button class="save" id="saveBtn">Save</button>
  </div>

  <h2>Rated Items</h2>
  <div id="ratedList"></div>
  <h2>Want to Try</h2>
  <div id="wantList"></div>
</div>

<script>
  const ratedListEl = document.getElementById("ratedList");
  const wantListEl = document.getElementById("wantList");
  const newTagInput = document.getElementById("newTagInput");
  const existingTagsSelect = document.getElementById("existingTags");
  const saveBtn = document.getElementById("saveBtn");

  let ratedItems = JSON.parse(localStorage.getItem("ratedItems")) || [];
  let wantItems = JSON.parse(localStorage.getItem("wantItems")) || [];
  let tags = JSON.parse(localStorage.getItem("tags")) || [];

  let editId = null;
  let editType = null;

  function normalizeItems() {
    ratedItems = ratedItems.map(item => {
      if (!item.id) item.id = 'r'+Date.now().toString(36)+Math.random().toString(36).slice(2,8);
      if (!item.tags && item.category) item.tags = [item.category];
      return item;
    });
    wantItems = wantItems.map(item => {
      if (!item.id) item.id = 'w'+Date.now().toString(36)+Math.random().toString(36).slice(2,8);
      if (!item.tags && item.category) item.tags = [item.category];
      return item;
    });
    updateGlobalTags();
  }

  normalizeItems();

  function updateGlobalTags() {
    const allTags = new Set(tags);
    ratedItems.concat(wantItems).forEach(item => {
      if (item.tags) item.tags.forEach(t => allTags.add(t));
    });
    tags = Array.from(allTags);
    localStorage.setItem("tags", JSON.stringify(tags));
    renderTagDropdown();
  }

  function renderTagDropdown() {
    existingTagsSelect.innerHTML = "";
    tags.forEach(t => {
      const opt = document.createElement("option");
      opt.value = t;
      opt.textContent = t;
      existingTagsSelect.appendChild(opt);
    });
  }

  function saveItem() {
    const name = document.getElementById("itemName").value.trim();
    const comment = document.getElementById("comment").value.trim();
    const rating = document.getElementById("rating").value;

    let inputTags = newTagInput.value.split(",").map(t => t.trim()).filter(t => t);
    const selectedTags = Array.from(existingTagsSelect.selectedOptions).map(o => o.value);
    const itemTags = Array.from(new Set([...inputTags, ...selectedTags]));

    if (!name) { alert("Enter an item name."); return; }
    if (itemTags.length === 0) { alert("Enter at least one tag."); return; }

    const item = {
      id: editId || ('i'+Date.now().toString(36)+Math.random().toString(36).slice(2,8)),
      name,
      tags: itemTags,
      rating: rating || null,
      comment
    };

    if (editId) {
      if (editType === "rated") ratedItems = ratedItems.filter(i => i.id !== editId);
      else wantItems = wantItems.filter(i => i.id !== editId);
    }

    if (rating) ratedItems.push(item);
    else wantItems.push(item);

    updateGlobalTags();
    localStorage.setItem("ratedItems", JSON.stringify(ratedItems));
    localStorage.setItem("wantItems", JSON.stringify(wantItems));

    editId = null;
    editType = null;
    document.getElementById("formTitle").textContent = "Add Item";
    document.getElementById("itemName").value = "";
    newTagInput.value = "";
    existingTagsSelect.selectedIndex = -1;
    document.getElementById("rating").value = "";
    document.getElementById("comment").value = "";

    renderLists();
  }

  function editItem(type, id) {
    let item = (type === "rated" ? ratedItems : wantItems).find(i => i.id === id);
    if (!item) return alert("Item not found.");

    document.getElementById("itemName").value = item.name;
    document.getElementById("comment").value = item.comment || "";
    document.getElementById("rating").value = item.rating || "";
    newTagInput.value = "";
    Array.from(existingTagsSelect.options).forEach(o => o.selected = item.tags.includes(o.value));

    editId = id;
    editType = type;
    document.getElementById("formTitle").textContent = "Edit Item";
  }

  function deleteItem(type, id) {
    if (type === "rated") ratedItems = ratedItems.filter(i => i.id !== id);
    else wantItems = wantItems.filter(i => i.id !== id);
    localStorage.setItem("ratedItems", JSON.stringify(ratedItems));
    localStorage.setItem("wantItems", JSON.stringify(wantItems));
    renderLists();
  }

  function renderLists() {
    function escapeHtml(text) {
      return text.replace(/[&<>"']/g, function(m) { return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m]; });
    }

    function renderList(el, items, type) {
      el.innerHTML = "";
      items.forEach(item => {
        const div = document.createElement("div");
        div.className = "card";
        div.innerHTML = `<strong>${escapeHtml(item.name)}</strong><br>
          ${item.tags.map(t => `<span class="tag">${escapeHtml(t)}</span>`).join(" ")}<br>
          ${item.rating ? `<span class="rating">${escapeHtml(item.rating)}</span><br>` : ""}
          <em>${escapeHtml(item.comment || "")}</em>`;
        const actions = document.createElement("div");
        actions.className = "actions";
        const editBtn = document.createElement("button");
        editBtn.className = "edit-btn";
        editBtn.textContent = "‚úèÔ∏è Edit";
        editBtn.addEventListener("click", () => editItem(type, item.id));
        const deleteBtn = document.createElement("button");
        deleteBtn.className = "delete-btn";
        deleteBtn.textContent = "üóë Delete";
        deleteBtn.addEventListener("click", () => deleteItem(type, item.id));
        actions.appendChild(editBtn);
        actions.appendChild(deleteBtn);
        div.appendChild(actions);
        el.appendChild(div);
      });
    }

    renderList(ratedListEl, ratedItems, "rated");
    renderList(wantListEl, wantItems, "want");
  }

  saveBtn.addEventListener("click", saveItem);

  renderLists();
  renderTagDropdown();
</script>
</body>
</html>
